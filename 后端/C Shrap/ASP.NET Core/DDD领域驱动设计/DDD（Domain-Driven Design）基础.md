# DDD领域驱动设计
## DDD基本概念
>* DDD是一个开发理念，核心是维护一个反映领域概念的模型（==领域模型==是软件最核心的部分，反映了软件的业务本质），然后通过大量模式来指导模型的设计和开发      
*   ----Domain Model（领域模型）:是最核心的部分
* ***“大量模式”** 指的是一组成熟的设计思想和实现方法，可以帮助开发者更好的构建和维护领域模型。这些模式提供了解决特定领域建模问题的模板或指南，确保邻域模型能够准确反映业务逻辑、表达业务意图，同时保持代码的可维护性和扩展性
	* ### **大量模式的含义**

- **解决建模中的常见问题**  
    这些模式是领域驱动设计过程中积累的经验总结，用于解决在构建领域模型时经常遇到的设计难题，比如领域对象的划分、边界的定义、复杂业务逻辑的管理等。
    
- **提高开发一致性和质量**  
    应用模式可以使开发团队在面对复杂领域时有一致的思路，从而提高代码质量和可维护性。
    
- **指导领域模型的开发和演进**  
    这些模式贯穿 DDD 的核心过程，包括限界上下文（Bounded Context）的划分、实体与值对象的定义、聚合的设计等。

>DDD的一般过程是：首先通过软件需求规格说明书或原型生成一个领域模型（类、类的属性、类与类之间的关系）；然后根据模式（应该如何分层？、领域逻辑写在哪？与持久化如何交互？如何协调多对象领域逻辑？如何实现逻辑与数据存储解耦等）指导来实现代码模型。
>----------------------------------------------------------------------------------
>1、如何分层？
>- 采用分层架构：
    - **用户界面层（UI Layer）**：处理用户交互和展示。  --前端 
    - **应用层（Application Layer）**：协调用例流程，不包含业务逻辑。
    - **领域层（Domain Layer）**：包含核心的领域模型和业务规则。
    - **基础设施层（Infrastructure Layer）**：处理持久化、消息队列、外部服务等技术细节。

>2、 **领域逻辑写在哪？**
    - **实体**：如果逻辑与具体对象密切相关（如验证自身状态），应放在实体中。
    - **值对象**：如果逻辑只操作不可变值，则放在值对象中。
    - **领域服务**：如果逻辑涉及多个对象的协作或超出单一对象职责，则提取为领域服务。


>3. **与持久化如何交互？**
    - 使用 **仓储模式（Repository Pattern）**：  
        仓储为聚合根提供一种抽象的持久化访问方式，使领域模型与持久化机制解耦。

>4. **如何协调多对象领域逻辑？**
    - 使用 **聚合模式**：  
        聚合将强相关的领域对象分组，并通过聚合根管理其内部状态和一致性。

>5. **如何解耦逻辑与数据存储？**
    - 通过 **工厂模式（Factory Pattern）** 和 **仓储模式**：  
        工厂负责创建复杂对象，仓储提供数据访问，确保领域逻辑只关注业务规则而不直接操作数据库。


#### **转化为代码模型**

在领域模型的基础上，结合 DDD 的模式实现可运行的代码模型：

1. **实现实体、值对象和领域服务**  
    根据领域模型中的类定义，将核心业务逻辑实现到代码中。
    
2. **实现聚合和聚合根**  
    确保聚合的边界清晰，并通过聚合根控制对聚合内部对象的访问。
    
3. **实现持久化**  
    使用仓储模式为每个聚合根提供数据存储和查询功能。持久化实现细节（如数据库交互）隐藏在基础设施层。
    
4. **实现上下文映射**  
    如果系统涉及多个限界上下文，则通过上下文映射定义它们的交互方式（如共享内核或防腐层）。
    
5. **定义应用层用例**  
    将应用流程封装在应用服务中，调用领域层的逻辑以实现具体用例。


* 怎么样生成一个领域模型？画图？什么图？核心要展示什么？

* ### **1. 如何生成一个领域模型？**

#### **(1) 什么是领域模型？**

领域模型是对业务领域中关键概念的抽象化表示，主要用于描述系统在当前上下文中需要解决的问题。领域模型包括以下核心内容：

- **实体（Entity）**：具有唯一标识和可变状态的对象。
- **值对象（Value Object）**：没有唯一标识，表示某些特定属性的对象。
- **聚合（Aggregate）**：定义一组强相关的领域对象及其一致性边界。
- **领域服务（Domain Service）**：定义与业务逻辑相关但不属于单一实体或值对象的操作。
- **关联关系**：领域对象之间的交互和依赖关系。

#### **(2) 领域模型的生成步骤**

1. **分析业务需求**
    
    - 与领域专家沟通，挖掘业务概念和流程。
    - 提取核心业务术语和关键场景，形成领域语言（Ubiquitous Language）。
2. **识别领域对象**
    
    - **找出实体**：哪些对象有生命周期和唯一标识（如“订单”、“客户”）？
    - **找出值对象**：哪些对象仅用来描述某些属性（如“地址”、“金额”）？
    - **定义聚合**：确定哪些对象是强关联的，并划分其边界。
    - **明确服务**：哪些操作逻辑不属于单一实体或值对象？
3. **定义对象的属性和行为**
    
    - 确定每个对象的关键属性和主要职责。
    - 定义对象间的交互方式和依赖关系。
4. **使用可视化工具绘制领域模型**
    
    - 将领域对象及其关系可视化为图形。

---

#### **(3) 画什么图？用什么工具？**

领域模型通常通过类图或实体关系图（ER 图）展示，核心是描述**领域对象**及其之间的关系。

1. **类图（UML Class Diagram）**
    
    - 描述领域对象（实体、值对象、服务）的结构和关系。
    - 展示：
        - 对象名称（如 `Order`、`Customer`）。
        - 属性（如 `OrderId`、`TotalPrice`）。
        - 方法（如 `AddItem()`、`CalculateTotal()`）。
        - 关联关系（如“聚合”、“一对多”）。
    
    **工具**：
    
    - Visual Paradigm
    - StarUML
    - PlantUML
2. **实体关系图（ER 图）**
    
    - 更专注于持久化层的设计，展示对象之间的关系。
    - 用于初步定义数据库表结构，但不直接表达业务逻辑。
    
    **工具**：
    
    - MySQL Workbench
    - dbdiagram.io
3. **上下文图（Context Map）**
    
    - 当系统涉及多个限界上下文时，使用上下文图展示上下文之间的关系。
4. **流程图（Business Process Diagram）**
    
    - 如果需求较复杂，可以补充用流程图表达业务流程。

#### **(4) 核心展示什么？**

- **领域模型的结构**：主要实体和值对象及其关系。
- **业务逻辑的核心抽象**：领域服务和聚合如何协作完成主要功能。
- **边界和依赖**：哪些对象属于同一个聚合，哪些跨越限界上下文。



### **2. 根据模式指导来实现代码模型怎么理解？**

#### **(1) 什么是“根据模式指导”？**

模式是设计过程中总结的通用解决方案，DDD 提供了一系列成熟的模式，用于指导开发者从领域模型到代码实现的转化。模式的作用是：

- 规范领域模型的实现方法。
- 提供解决复杂业务场景的标准化思路。
- 确保模型的设计和实现与 DDD 的原则一致。

>DDD中最核心的是Domain Model（领域模型），和领域模型相对的是事务脚本。领域模型和事务脚本说到底就是面向对象和面向过程的区别。

## 领域驱动设计基本架构
![[Pasted image 20241122105939.png]]
### 从整体框架上来看分为四个层：
- Presentation Layer：表现层，负责显示和接受输入；
- Application Layer(Service)：应用层，很薄的一层，只包含工作流控制逻辑，不包含业务逻辑；
- Domain Layer(Domain)：领域层，包含整个应用的所有业务逻辑；
- Infrastructure Layer：基础层，提供整个应用的基础服务；
-
![[Pasted image 20241122110226.png]]