import { b as t, w as e } from "../utils/index.js";
import { defineComponent as a, useSlots as o, reactive as l, ref as i, computed as n, provide as u, shallowRef as s, watch as r, nextTick as c, onMounted as v, openBlock as f, createElementBlock as d, normalizeClass as p, createElementVNode as b, normalizeStyle as m, unref as y, createCommentVNode as h, Fragment as g, renderList as C, withModifiers as k, createBlock as P, createVNode as w, renderSlot as x, h as R, createTextVNode as B } from "vue";
import { _ as $ } from "../checkbox/index2.js";
import { T as _, _ as D } from "../tabItem/index2.js";
import { R as I } from "../dropdown/index2.js";
import { a as M } from "../_chunks/@vueuse/index.js";
const S = ["onClick"], V = ["onClick"], X = { class: "layui-tab-content" }, j = a({ name: "LayTab", props: { type: null, modelValue: null, allowClose: { type: Boolean }, tabPosition: { default: "top" }, beforeClose: null, beforeLeave: null, activeBarTransition: { type: Boolean } }, emits: ["update:modelValue", "change", "close"], setup(e2, { emit: a2 }) {
  const j2 = e2, L2 = o(), T = l(/* @__PURE__ */ new Map()), W = i([]), Y = function(e3) {
    e3 == null ? void 0 : e3.map((e4) => {
      t(e4, e4.children) ? Y(e4.children) : e4.type.name == D.name && W.value.push(e4);
    });
  }, q = n({ get: () => j2.modelValue, set(t2) {
    a2("update:modelValue", t2);
  } }), E = n(() => {
    const t2 = [];
    return W.value.forEach((e3) => {
      var _a;
      const a3 = T.get((_a = e3.props) == null ? void 0 : _a.id);
      a3 && t2.push(a3);
    }), t2;
  });
  u(_, l({ active: q, addItem: (t2, e3) => {
    T.set(t2, e3);
  }, removeItem: (t2) => {
    T.delete(t2);
  } }));
  const F = function(t2) {
    j2.beforeLeave && false === j2.beforeLeave(t2) || (a2("update:modelValue", t2), a2("change", t2));
  }, H = s(void 0), A = s(void 0), N = i(), z = s(void 0), G = i(false), J = i(0), K = n(() => {
    var _a;
    const t2 = "top" === j2.tabPosition || "bottom" === j2.tabPosition ? "X" : "Y", e3 = "X" === t2 ? "left" : "top", a3 = (_a = et(Z.value)) != null ? _a : 0;
    return { transform: `translate${t2}(-${J.value}px)`, [e3]: G.value ? `${a3}px` : 0 };
  }), O = n(() => "top" === j2.tabPosition || "bottom" === j2.tabPosition ? "Width" : "Height"), Q = function() {
    var _a;
    let t2 = 0;
    const e3 = (_a = z.value) == null ? void 0 : _a.querySelectorAll("li");
    return e3 == null ? void 0 : e3.forEach((e4) => {
      t2 += et(e4);
    }), t2;
  }, U = s(void 0), Z = s(void 0), tt = function() {
    if (!z.value)
      return;
    const t2 = et(z.value), e3 = J.value;
    if (!e3)
      return;
    let a3 = e3 > t2 ? e3 - t2 : 0;
    J.value = a3;
  }, et = function(t2) {
    return t2 ? "Width" === O.value ? t2.offsetWidth + parseInt(window.getComputedStyle(t2).marginLeft) + parseInt(window.getComputedStyle(t2).marginRight) : t2.offsetHeight + parseInt(window.getComputedStyle(t2).marginTop) + parseInt(window.getComputedStyle(t2).marginBottom) : 0;
  }, at = function() {
    var _a, _b;
    if (!z.value)
      return;
    const t2 = Q(), e3 = et(z.value), a3 = J.value, o2 = (_a = et(U.value)) != null ? _a : 0, l2 = (_b = et(Z.value)) != null ? _b : 0;
    if (t2 - a3 <= e3)
      return;
    let i2 = t2 - a3 > 2 * e3 ? a3 + e3 : t2 - e3 + o2 + l2;
    J.value = i2;
  }, ot = s(void 0), lt = function() {
    var _a, _b;
    if (!G.value)
      return;
    const t2 = A.value, e3 = ot.value;
    if (!t2 || !e3)
      return;
    const a3 = t2 == null ? void 0 : t2.getBoundingClientRect(), o2 = e3 == null ? void 0 : e3.getBoundingClientRect(), l2 = ["top", "bottom"].includes(j2.tabPosition), i2 = J.value;
    let n2 = i2;
    const u2 = Q(), s2 = (_a = et(U.value)) != null ? _a : 0, r2 = (_b = et(Z.value)) != null ? _b : 0, c2 = l2 ? u2 - o2.width + s2 + r2 : u2 - o2.height + s2 + r2;
    l2 ? (a3.left < o2.left && (n2 = i2 - (o2.left - a3.left), n2 -= r2), a3.right > o2.right && (n2 = i2 + a3.right - o2.right, n2 += s2)) : (a3.top < o2.top && (n2 = i2 - (o2.top - a3.top)), a3.bottom > o2.bottom && (n2 = i2 + (a3.bottom - o2.bottom))), n2 = Math.max(n2, 0), J.value = Math.min(n2, c2);
  }, it = () => {
    var _a, _b, _c;
    if (!z.value)
      return;
    if (A.value = (_a = z.value) == null ? void 0 : _a.querySelector(".layui-this"), N.value = (() => {
      let t3 = 0, e4 = 0;
      const a4 = "top" === j2.tabPosition || "bottom" === j2.tabPosition ? "width" : "height", o3 = "width" === a4 ? "X" : "Y", l3 = "X" === o3 ? "left" : "top", i2 = A.value, n2 = z.value;
      if (!i2 || !n2)
        return;
      const u2 = i2 == null ? void 0 : i2.getBoundingClientRect(), s2 = n2 == null ? void 0 : n2.getBoundingClientRect();
      return t3 = u2[l3] - s2[l3], e4 = i2.getBoundingClientRect()[a4], { [a4]: `${e4}px`, transform: `translate${o3}(${t3}px)`, transition: j2.activeBarTransition ? "transform .3s" : "" };
    })(), "top" !== j2.tabPosition && "bottom" !== j2.tabPosition)
      return;
    const t2 = Q(), e3 = et(z.value), a3 = J.value, o2 = (_b = et(U.value)) != null ? _b : 0, l2 = (_c = et(Z.value)) != null ? _c : 0;
    if (e3 < t2) {
      const a4 = J.value;
      G.value = true, t2 - a4 < e3 && (J.value = t2 - e3 + o2 + l2), lt();
    } else
      G.value = false, a3 > 0 && (J.value = 0);
  }, nt = (t2) => {
    var _a;
    t2.preventDefault();
    const e3 = Q(), a3 = et(z.value), o2 = J.value, l2 = (_a = et(U.value)) != null ? _a : 0, i2 = Math.abs(t2.deltaX) >= Math.abs(t2.deltaY) ? t2.deltaX : t2.deltaY, n2 = 50 * (i2 > 0 ? 1 : -1), u2 = Math.max(o2 + n2, 0);
    e3 - o2 <= a3 - l2 && i2 > 0 || (J.value = u2);
  }, ut = (t2) => {
    const e3 = t2.tabData;
    return "function" == typeof e3.icon ? e3.icon() : "string" == typeof e3.icon ? R($, { type: e3.icon, style: "margin-right: 8px;" }) : void 0;
  }, st = (t2) => {
    var _a, _b;
    const e3 = t2.tabData;
    return ((_a = e3.slots) == null ? void 0 : _a.title) ? R(g, ((_b = e3.slots) == null ? void 0 : _b.title) && e3.slots.title()) : "function" == typeof e3.title ? e3.title() : "string" == typeof e3.title ? B(e3.title) : void 0;
  };
  return M(z, it), r(T, () => {
    W.value = [], Y(L2.default && L2.default());
  }, { immediate: true, deep: true }), r(() => [j2.modelValue, j2.tabPosition, j2.type, W.value.length], async () => {
    await c(), it();
  }), v(() => {
    it(), lt();
  }), u("active", q), (t2, o2) => (f(), d("div", { class: p(["layui-tab", [e2.type ? "layui-tab-" + e2.type : "", j2.tabPosition ? `is-${e2.tabPosition}` : ""]]) }, [b("div", { ref_key: "headRef", ref: ot, class: p(["layui-tab-head", j2.tabPosition ? `is-${e2.tabPosition}` : ""]) }, [b("ul", { ref_key: "navRef", ref: z, onWheel: nt, class: p(["layui-tab-title", j2.tabPosition ? `is-${e2.tabPosition}` : ""]), style: m(y(K)) }, ["brief" === e2.type ? (f(), d("div", { key: 0, ref_key: "activeBarRef", ref: H, class: "layui-tab-active-bar", style: m(N.value) }, null, 4)) : h("", true), (f(true), d(g, null, C(y(E), (t3, o3) => (f(), d("li", { key: t3.id, class: p([t3.id === y(q) ? "layui-this" : ""]), onClick: k((e3) => F(t3.id), ["stop"]) }, [b("span", null, [t3.icon ? (f(), P(y(I), { key: 0, renderFunc: ut, tabData: t3 }, null, 8, ["tabData"])) : h("", true), w(y(I), { renderFunc: st, tabData: t3 }, null, 8, ["tabData"])]), e2.allowClose && 0 != t3.closable ? (f(), d("i", { key: 0, class: "layui-icon layui-icon-close layui-unselect layui-tab-close", onClick: k((e3) => function(t4, e4) {
    if (!j2.beforeClose || false !== j2.beforeClose(e4)) {
      if (W.value.splice(t4, 1), q.value === e4) {
        const e5 = W.value[t4 === W.value.length ? 0 : t4];
        F(e5 && e5.props ? e5.props.id : "");
      }
      a2("close", e4);
    }
  }(o3, t3.id), ["stop"]) }, null, 8, V)) : h("", true)], 10, S))), 128))], 38), G.value ? (f(), d("span", { key: 0, ref_key: "scrollPrevRef", ref: Z, class: "layui-unselect layui-tab-bar prev", onClick: tt }, [w(y($), { type: "layui-icon-left" })], 512)) : h("", true), G.value ? (f(), d("span", { key: 1, ref_key: "scrollNextRef", ref: U, class: "layui-unselect layui-tab-bar", onClick: at }, [w(y($), { type: "layui-icon-right" })], 512)) : h("", true)], 2), b("div", X, [x(t2.$slots, "default")])], 2));
} }), L = e(j);
export { L as default };
